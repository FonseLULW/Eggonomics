<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>New Shopping List</title>
    <meta name="comp1800 boilerplate code" content="my bcit project" />
    <meta name="DTC08" content="Eggonomics Shopping List" />

    <!-- CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles/styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link
      type="text/css"
      rel="stylesheet"
      href="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.css"
    />

    <!-- Firebase 8 CDNs -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <script src="/scripts/firebaseAPI.js"></script>
  <style>
    .shopping-list-container {
      display: flex;
      flex-direction: column;
      margin-top: 1rem;
      margin-bottom: 2rem;
      width: 80vw;
      margin-left: auto;
      margin-right: auto;
      /* background-color: lightgrey; */
      border-radius: 5px;
      padding-left: 30px;
      padding-right: 30px;
      padding-top: 20px;
      padding-bottom: 20px;
      box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
    }

    .btn {
      margin-left: auto;
      margin-right: auto;
    }

    .list-items {
      margin-left: auto;
      margin-right: auto;
      padding-left: 30px;
      padding-right: 30px;
    }
  </style>
  </head>

  <body>
    <!-- Top Nav Bar -->
    <nav class="navbar navbar-light bg-warning">
      <div class="container">
        <div class="navbar-brand">
          <a class="icon-btn" href="shopping_list.html"
            ><span class="material-icons md-18"> arrow_back_ios </span></a
          >
          <span>Shopping List</span>
        </div>
      </div>
    </nav>

    <!-- Text Fields -->
    <div class="shopping-list-container bg-light shadow" >
      <form>
        <fieldset class="mb-3" id="personalInfoFields">
          <div class="form-group">
            <label>Item</label>
            <input
              type="text"
              id="itemInput"
              class="form-control"
              placeholder="Enter an item"
            />
          </div>
        </fieldset>
        <div class="d-flex justify-content-end mt-5">
          <span style="width: 10px"></span>
          <button type="button" class="btn btn-warning" onclick="saveItem()">
            Add
          </button>
        </div>
      </form>
    </div>

    <!-- Shopping List Items -->
    <ul class="list-group list-items">
      <li class="list-group-item">Item 1</li>
      <li class="list-group-item">Item 2</li>
      <li class="list-group-item">Item 3</li>
      <li class="list-group-item">Item 4</li>
      <li class="list-group-item">Item 5</li>
    </ul>

    <!-- Bottom Nav Bar -->
    <footer
      class="navbar justify-content-evenly bg-warning fixed-bottom"
      style="height: 4em"
    >
      <a class="icon-btn" href="index.html">
        <i class="material-icons">shopping_cart</i>
        <p class="btm-btn-text">Price Track</p>
      </a>
      <a class="icon-btn" href="inventory.html">
        <i class="material-icons">kitchen</i>
        <p class="btm-btn-text">Pantry</p>
      </a>
      <a class="icon-btn" href="shopping_list.html">
        <i class="material-icons">playlist_add_check</i>
        <p class="btm-btn-text">Shopping List</p>
      </a>
      <a class="icon-btn" href="">
        <i class="material-icons">bar_chart</i>
        <p class="btm-btn-text">Analytics</p>
      </a>
    </footer>

    <!--------------------------------------------------------------------->
    <!-- JS files: Your own JavaScript functions included here    -->
    <!--------------------------------------------------------------------->
    <script>
      function saveItem() {
        let Item = document.getElementById("itemInput").value;

        firebase.auth().onAuthStateChanged((user) => {
          if (user) {
            var currentUser = db.collection("users").doc(user.uid);
            console.log(user);
            var userID = user.uid;

            currentUser.get().then((userDoc) => {
              //get user Email
              var userEmail = userDoc.data().email;
              // Start a new collection and add all data in it.

              var docref = db.collection("shopping list").doc(userID);
              var doc = docref.get().then((res) => {
                if (!res.exists) {
                  db.collection("shopping list")
                    .doc(userID)
                    .set({
                      UserID: userID,
                      UserEmail: userEmail,
                      Item: firebase.firestore.FieldValue.arrayUnion(Item),
                    });
                }
                db.collection("shopping list")
                  .doc(userID)
                  .update({
                    Item: firebase.firestore.FieldValue.arrayUnion(Item),
                  });
              });
            });
          } else {
            // No user is signed in.
            console.log("no user signed in");
          }
        });
      }
    </script>
  </body>
</html>
